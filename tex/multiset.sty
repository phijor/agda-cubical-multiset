\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{multiset}[2022/10/01 Package for a multiset-in-agda paper]

\RequirePackage{kvoptions}

\DeclareBoolOption{debug}{%
    \def\thmt@debug{\typeout}%
}

\DeclareDefaultOption{\PackageWarning{multiset}{Unknown ‘\CurrentOption’}}

\ProcessKeyvalOptions*

% LaTeX package loading is a mess.
% Shout-out to hyperref for being particularly obtuse.
% See: https://texblog.net/hyperref/

\RequirePackage[utf8]{inputenc}
\RequirePackage{newunicodechar}

\RequirePackage{xparse}
\RequirePackage{amsmath}
\RequirePackage{amsthm}

\RequirePackage{amsfonts}
\RequirePackage{stmaryrd} % for \{l,r}bag

\PassOptionsToPackage{colorlinks}{hyperref}
\RequirePackage{doi} % Links to DOI in bibliography

\RequirePackage{csquotes}
\RequirePackage[capitalize]{cleveref} % Load last because... duh, LaTeX.

\newunicodechar{ℕ}{\ensuremath{\mathbb{N}}}
\newunicodechar{→}{\ensuremath{\mathrel{\mathnormal\to}}}
\newunicodechar{∀}{\ensuremath{\mathnormal\forall}}
\newunicodechar{∃}{\ensuremath{\mathop{\mathnormal\exists\/}}}
\newunicodechar{≃}{\mathbin{\mathnormal\simeq}}

\DeclareMathOperator{\Chain}{ch}
\DeclareMathOperator{\Shift}{sh}
\DeclareMathOperator{\Type}{Type}
\DeclareMathOperator{\Fin}{Fin}
\DeclareMathOperator{\Sym}{\mathfrak{S}}

\newcommand*{\Empty}{\mathsf{\varepsilon}}
\newcommand*{\Singl}{\operatorname{\mathsf{\eta}}}
\newcommand*{\Union}{\mathbin{\oplus}}
\newcommand*{\Var}[1]{\mathit{#1}}
\newcommand*{\Op}[1]{\operatorname{\mathsf{#1}}}

\newcommand*{\DefEq}{\ensuremath{\mathbin{=_\mathsf{df}}}}

\DeclareMathOperator{\Refl}{\mathsf{refl}}
\DeclareMathOperator{\PathP}{\mathsf{PathP}}

\DeclareMathOperator{\FMSet}{\mathsf{FMSet}}
\DeclareMathOperator{\Bag}{\mathsf{Bag}}
\newcommand*{\FMGpd}{%
    \PackageWarning{multiset}{Use \\Bag, dummy!}%
    \Bag
}
\DeclareMathOperator{\Tote}{\mathsf{Tote}}

\DeclareMathOperator{\FinSet}{\mathsf{FinSet}}

\DeclareMathOperator{\Bij}{\mathsf{Bij}}
\DeclareMathOperator{\Obj}{\mathsf{obj}}
\DeclareMathOperator{\Hom}{\mathsf{hom}}

\DeclareMathOperator{\Idx}{\mathsf{Idx}}

\NewDocumentCommand{\Rec}{m}{\Op{rec}_{#1}}
\NewDocumentCommand{\Elim}{m}{\Op{elim}_{#1}}

\DeclareMathOperator{\IsProp}{\mathsf{isProp}}
\DeclareMathOperator{\IsSet}{\mathsf{isSet}}
\DeclareMathOperator{\IsGpd}{\mathsf{isGroupoid}}

\NewDocumentCommand{\Lim}{m}{L_{#1}}

\newcommand*{\UU}{\ensuremath{\mathcal{U}}}

\newcommand*{\Where}{\ensuremath{\mathpunct{.}}}

\newcommand*{\N}{\ensuremath{\mathbb{N}}}

\newcommand*{\M}{\ensuremath{\mathsf{M}}}

\newcommand*{\Blank}{\ensuremath{\mathord{\_}}}

\NewDocumentCommand{\Trunc}{m m}{\ensuremath{{\lVert #2 \rVert}_{\mathsf{#1}}}}
\NewDocumentCommand{\TruncCon}{m m}{\ensuremath{{\lvert #2 \rvert}_{\mathsf{#1}}}}
\NewDocumentCommand{\TruncSquash}{m}{\ensuremath{\Op{squash}_{\mathsf{#1}}}}

\NewDocumentCommand{\PropTrunc}{ m }{\Trunc{1}{#1}}
\NewDocumentCommand{\PropTruncCon}{ O{\Blank} }{\TruncCon{1}{#1}}
\NewDocumentCommand{\PropTruncSquash}{}{\TruncSquash{1}}

\NewDocumentCommand{\SetTrunc}{ m }{\Trunc{2}{#1}}
\NewDocumentCommand{\SetTruncCon}{ O{\Blank} }{\TruncCon{2}{#1}}
\NewDocumentCommand{\SetTruncSquash}{}{\TruncSquash{2}}

\NewDocumentCommand{\BinRel}{ m O{\Blank} O{\Blank} }{%
    \ensuremath{#2 \mathrel{#1} #3}
}
\NewDocumentCommand{\SquashOp}{m}{\mathop{\mathsf{/_{\! #1}}}}

\NewDocumentCommand{\SetQuot}{ O{\Blank} O{\Blank}}{#1 \SquashOp{2} #2}
\NewDocumentCommand{\SetQuotCon}{ O{\Blank} }{\ensuremath{{[#1]}_{\mathsf{2}}}}
\NewDocumentCommand{\SetQuotSquash}{}{\operatorname{\mathsf{squash/}_{\!\mathsf{2}}}}

\newcommand*{\SymmetricAction}[1]{\BinRel{\sim_{#1}}}

\newcommand*{\LLPO}{LLPO}
\newcommand*{\True}{\ensuremath{\mathsf{true}}}
\newcommand*{\False}{\ensuremath{\mathsf{false}}}

\crefname{step}{step}{steps}
\creflabelformat{step}{(#2#1#3)}

\NewDocumentCommand{\Step}{m}{\label[step]{#1}}
